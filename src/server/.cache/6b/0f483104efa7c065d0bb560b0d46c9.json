{"id":"WZ4i","dependencies":[{"name":"C:\\xampp\\htdocs\\pet\\src\\server\\.babelrc","includedInParent":true,"mtime":1607404923905},{"name":"C:\\xampp\\htdocs\\pet\\src\\server\\package.json","includedInParent":true,"mtime":1607412288975},{"name":"./../lib/MidoDb","loc":{"line":1,"column":23},"parent":"C:\\xampp\\htdocs\\pet\\src\\server\\routes\\sub.js","resolved":"C:\\xampp\\htdocs\\pet\\src\\server\\lib\\MidoDb.js"},{"name":"./../lib/Utils","loc":{"line":2,"column":22},"parent":"C:\\xampp\\htdocs\\pet\\src\\server\\routes\\sub.js","resolved":"C:\\xampp\\htdocs\\pet\\src\\server\\lib\\Utils.js"}],"generated":{"js":"function e(e,n,r,t,o,s,i){try{var u=e[s](i),c=u.value}catch(l){return void r(l)}u.done?n(c):Promise.resolve(c).then(t,o)}function n(n){return function(){var r=this,t=arguments;return new Promise(function(o,s){var i=n.apply(r,t);function u(n){e(i,o,s,u,c,\"next\",n)}function c(n){e(i,o,s,u,c,\"throw\",n)}u(void 0)})}}var r=require(\"./../lib/MidoDb\"),t=require(\"./../lib/Utils\");module.exports=function(){var e=n(regeneratorRuntime.mark(function e(n,o,s){var i,u,c,l,a,d,b=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=b.length>3&&void 0!==b[3]?b[3]:\"channel_subscription\",u=n.query,c=n.session,u&&u[\"channel-id\"]){e.next=5;break}return e.abrupt(\"return\",o.send(t.buildResponse(!1,\"invalid params\")));case 5:if(l=u[\"channel-id\"],a=u.channel,(d=c.user_id)&&null!=d){e.next=10;break}return e.abrupt(\"return\",o.send(t.buildResponse(!1,\"Please login first\")));case 10:if(a&&null!=a){e.next=12;break}return e.abrupt(\"return\",o.send(t.buildResponse(!1,\"Invalid channel selected\")));case 12:console.log(\"test here\"),r.init(\"mongodb\").then(function(e){var n={user_id:d,channel_id:l};r.selectRecord(i,n).then(function(e){if(console.log(e),e.length&&e.length>=0){return r.closeDb(),o.send(t.buildResponse(!1,\"You are already subscribed\"))}r.init(\"mongodb\").then(function(e){var n={user_id:d,channel_id:l,channel:a,status:1};r.insertRecord(n,i).then(function(e){if(1!==e.ok){return r.closeDb(),o.send(t.buildResponse(!1,\"Could not subscribe. Please try again\"))}return r.closeDb(),o.send(t.buildResponse(!0,\"You are now subscribed\",null,null,e))}).catch(function(e){return console.log(e.message)})}).catch(function(e){return console.log(e.message)})}).catch(function(e){return console.log(e.message)})}).catch(function(e){return console.log(e)});case 14:case\"end\":return e.stop()}},e)}));return function(n,r,t){return e.apply(this,arguments)}}();"},"sourceMaps":{"js":{"mappings":[{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":0}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":9}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":11}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":13}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":15}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":17}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":19}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":21}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":23}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":26}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":30}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":34}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":36}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":38}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":41}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":44}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":46}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":48}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":54}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":60}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":63}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":75}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":77}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":80}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":82}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":87}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":89}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":92}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":100}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":108}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":111}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":116}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":118}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":121}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":130}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":132}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":135}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":142}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":153}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":157}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":159}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":164}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":166}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":176}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":183}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":187}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":195}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":204}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":206}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":209}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":213}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":215}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":217}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":223}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":225}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":228}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":237}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":239}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":242}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":244}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":246}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":248}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":250}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":252}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":254}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":261}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":264}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":273}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":275}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":278}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":280}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":282}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":284}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":286}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":288}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":290}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":298}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":301}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":308}},{"source":"../routes/sub.js","original":{"line":1,"column":0},"generated":{"line":1,"column":314}},{"source":"../routes/sub.js","name":"MidoDb","original":{"line":1,"column":6},"generated":{"line":1,"column":318}},{"source":"../routes/sub.js","name":"require","original":{"line":1,"column":15},"generated":{"line":1,"column":320}},{"source":"../routes/sub.js","original":{"line":1,"column":23},"generated":{"line":1,"column":328}},{"source":"../routes/sub.js","name":"Utils","original":{"line":2,"column":6},"generated":{"line":1,"column":347}},{"source":"../routes/sub.js","name":"require","original":{"line":2,"column":14},"generated":{"line":1,"column":349}},{"source":"../routes/sub.js","original":{"line":2,"column":22},"generated":{"line":1,"column":357}},{"source":"../routes/sub.js","name":"module","original":{"line":4,"column":0},"generated":{"line":1,"column":375}},{"source":"../routes/sub.js","name":"exports","original":{"line":4,"column":7},"generated":{"line":1,"column":382}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":390}},{"source":"../routes/sub.js","original":{"line":4,"column":17},"generated":{"line":1,"column":401}},{"source":"../routes/sub.js","original":{"line":4,"column":17},"generated":{"line":1,"column":405}},{"source":"../routes/sub.js","original":{"line":4,"column":17},"generated":{"line":1,"column":407}},{"source":"../routes/sub.js","original":{"line":4,"column":17},"generated":{"line":1,"column":409}},{"source":"../routes/sub.js","original":{"line":4,"column":17},"generated":{"line":1,"column":428}},{"source":"../routes/sub.js","original":{"line":4,"column":17},"generated":{"line":1,"column":433}},{"source":"../routes/sub.js","name":"req","original":{"line":4,"column":24},"generated":{"line":1,"column":442}},{"source":"../routes/sub.js","name":"req","original":{"line":4,"column":24},"generated":{"line":1,"column":444}},{"source":"../routes/sub.js","name":"res","original":{"line":4,"column":29},"generated":{"line":1,"column":446}},{"source":"../routes/sub.js","name":"next","original":{"line":4,"column":34},"generated":{"line":1,"column":448}},{"source":"../routes/sub.js","original":{"line":4,"column":17},"generated":{"line":1,"column":451}},{"source":"../routes/sub.js","original":{"line":4,"column":17},"generated":{"line":1,"column":455}},{"source":"../routes/sub.js","original":{"line":4,"column":17},"generated":{"line":1,"column":457}},{"source":"../routes/sub.js","original":{"line":4,"column":17},"generated":{"line":1,"column":459}},{"source":"../routes/sub.js","original":{"line":4,"column":17},"generated":{"line":1,"column":461}},{"source":"../routes/sub.js","original":{"line":4,"column":17},"generated":{"line":1,"column":463}},{"source":"../routes/sub.js","original":{"line":4,"column":17},"generated":{"line":1,"column":465}},{"source":"../routes/sub.js","original":{"line":4,"column":17},"generated":{"line":1,"column":467}},{"source":"../routes/sub.js","original":{"line":4,"column":17},"generated":{"line":1,"column":469}},{"source":"../routes/sub.js","original":{"line":4,"column":17},"generated":{"line":1,"column":479}},{"source":"../routes/sub.js","original":{"line":4,"column":17},"generated":{"line":1,"column":486}},{"source":"../routes/sub.js","original":{"line":4,"column":17},"generated":{"line":1,"column":505}},{"source":"../routes/sub.js","original":{"line":4,"column":17},"generated":{"line":1,"column":510}},{"source":"../routes/sub.js","original":{"line":4,"column":17},"generated":{"line":1,"column":519}},{"source":"../routes/sub.js","original":{"line":4,"column":17},"generated":{"line":1,"column":522}},{"source":"../routes/sub.js","original":{"line":4,"column":17},"generated":{"line":1,"column":529}},{"source":"../routes/sub.js","original":{"line":4,"column":17},"generated":{"line":1,"column":536}},{"source":"../routes/sub.js","original":{"line":4,"column":17},"generated":{"line":1,"column":538}},{"source":"../routes/sub.js","original":{"line":4,"column":17},"generated":{"line":1,"column":543}},{"source":"../routes/sub.js","original":{"line":4,"column":17},"generated":{"line":1,"column":545}},{"source":"../routes/sub.js","original":{"line":4,"column":17},"generated":{"line":1,"column":551}},{"source":"../routes/sub.js","original":{"line":4,"column":17},"generated":{"line":1,"column":556}},{"source":"../routes/sub.js","original":{"line":9,"column":8},"generated":{"line":1,"column":558}},{"source":"../routes/sub.js","name":"baseTable","original":{"line":4,"column":40},"generated":{"line":1,"column":561}},{"source":"../routes/sub.js","original":{"line":4,"column":52},"generated":{"line":1,"column":563}},{"source":"../routes/sub.js","original":{"line":4,"column":52},"generated":{"line":1,"column":565}},{"source":"../routes/sub.js","original":{"line":4,"column":52},"generated":{"line":1,"column":572}},{"source":"../routes/sub.js","original":{"line":4,"column":52},"generated":{"line":1,"column":580}},{"source":"../routes/sub.js","original":{"line":4,"column":52},"generated":{"line":1,"column":584}},{"source":"../routes/sub.js","original":{"line":4,"column":52},"generated":{"line":1,"column":586}},{"source":"../routes/sub.js","original":{"line":4,"column":52},"generated":{"line":1,"column":589}},{"source":"../routes/sub.js","original":{"line":4,"column":52},"generated":{"line":1,"column":591}},{"source":"../routes/sub.js","original":{"line":4,"column":52},"generated":{"line":1,"column":594}},{"source":"../routes/sub.js","name":"data","original":{"line":6,"column":10},"generated":{"line":1,"column":617}},{"source":"../routes/sub.js","name":"req","original":{"line":6,"column":17},"generated":{"line":1,"column":619}},{"source":"../routes/sub.js","name":"query","original":{"line":6,"column":21},"generated":{"line":1,"column":621}},{"source":"../routes/sub.js","name":"session","original":{"line":7,"column":10},"generated":{"line":1,"column":627}},{"source":"../routes/sub.js","name":"req","original":{"line":7,"column":20},"generated":{"line":1,"column":629}},{"source":"../routes/sub.js","name":"session","original":{"line":7,"column":24},"generated":{"line":1,"column":631}},{"source":"../routes/sub.js","name":"data","original":{"line":9,"column":9},"generated":{"line":1,"column":639}},{"source":"../routes/sub.js","name":"data","original":{"line":9,"column":18},"generated":{"line":1,"column":642}},{"source":"../routes/sub.js","original":{"line":9,"column":23},"generated":{"line":1,"column":644}},{"source":"../routes/sub.js","original":{"line":4,"column":17},"generated":{"line":1,"column":658}},{"source":"../routes/sub.js","original":{"line":4,"column":17},"generated":{"line":1,"column":659}},{"source":"../routes/sub.js","original":{"line":4,"column":17},"generated":{"line":1,"column":661}},{"source":"../routes/sub.js","original":{"line":4,"column":17},"generated":{"line":1,"column":666}},{"source":"../routes/sub.js","original":{"line":4,"column":17},"generated":{"line":1,"column":668}},{"source":"../routes/sub.js","name":"res","original":{"line":10,"column":15},"generated":{"line":1,"column":674}},{"source":"../routes/sub.js","name":"res","original":{"line":10,"column":15},"generated":{"line":1,"column":681}},{"source":"../routes/sub.js","name":"res","original":{"line":10,"column":15},"generated":{"line":1,"column":683}},{"source":"../routes/sub.js","name":"res","original":{"line":10,"column":15},"generated":{"line":1,"column":690}},{"source":"../routes/sub.js","name":"res","original":{"line":10,"column":15},"generated":{"line":1,"column":699}},{"source":"../routes/sub.js","name":"send","original":{"line":10,"column":19},"generated":{"line":1,"column":701}},{"source":"../routes/sub.js","name":"Utils","original":{"line":10,"column":24},"generated":{"line":1,"column":706}},{"source":"../routes/sub.js","name":"buildResponse","original":{"line":10,"column":30},"generated":{"line":1,"column":708}},{"source":"../routes/sub.js","original":{"line":10,"column":44},"generated":{"line":1,"column":723}},{"source":"../routes/sub.js","original":{"line":10,"column":51},"generated":{"line":1,"column":725}},{"source":"../routes/sub.js","original":{"line":4,"column":17},"generated":{"line":1,"column":745}},{"source":"../routes/sub.js","original":{"line":4,"column":17},"generated":{"line":1,"column":750}},{"source":"../routes/sub.js","original":{"line":16,"column":8},"generated":{"line":1,"column":752}},{"source":"../routes/sub.js","name":"channelId","original":{"line":12,"column":10},"generated":{"line":1,"column":755}},{"source":"../routes/sub.js","name":"data","original":{"line":12,"column":22},"generated":{"line":1,"column":757}},{"source":"../routes/sub.js","original":{"line":12,"column":27},"generated":{"line":1,"column":759}},{"source":"../routes/sub.js","name":"channel","original":{"line":13,"column":10},"generated":{"line":1,"column":773}},{"source":"../routes/sub.js","name":"data","original":{"line":13,"column":20},"generated":{"line":1,"column":775}},{"source":"../routes/sub.js","name":"channel","original":{"line":13,"column":25},"generated":{"line":1,"column":777}},{"source":"../routes/sub.js","name":"userId","original":{"line":14,"column":10},"generated":{"line":1,"column":786}},{"source":"../routes/sub.js","name":"session","original":{"line":14,"column":19},"generated":{"line":1,"column":788}},{"source":"../routes/sub.js","name":"user_id","original":{"line":14,"column":27},"generated":{"line":1,"column":790}},{"source":"../routes/sub.js","original":{"line":16,"column":8},"generated":{"line":1,"column":800}},{"source":"../routes/sub.js","name":"userId","original":{"line":16,"column":19},"generated":{"line":1,"column":806}},{"source":"../routes/sub.js","original":{"line":4,"column":17},"generated":{"line":1,"column":808}},{"source":"../routes/sub.js","original":{"line":4,"column":17},"generated":{"line":1,"column":809}},{"source":"../routes/sub.js","original":{"line":4,"column":17},"generated":{"line":1,"column":811}},{"source":"../routes/sub.js","original":{"line":4,"column":17},"generated":{"line":1,"column":816}},{"source":"../routes/sub.js","original":{"line":4,"column":17},"generated":{"line":1,"column":819}},{"source":"../routes/sub.js","name":"res","original":{"line":17,"column":15},"generated":{"line":1,"column":825}},{"source":"../routes/sub.js","name":"res","original":{"line":17,"column":15},"generated":{"line":1,"column":832}},{"source":"../routes/sub.js","name":"res","original":{"line":17,"column":15},"generated":{"line":1,"column":834}},{"source":"../routes/sub.js","name":"res","original":{"line":17,"column":15},"generated":{"line":1,"column":841}},{"source":"../routes/sub.js","name":"res","original":{"line":17,"column":15},"generated":{"line":1,"column":850}},{"source":"../routes/sub.js","name":"send","original":{"line":17,"column":19},"generated":{"line":1,"column":852}},{"source":"../routes/sub.js","name":"Utils","original":{"line":17,"column":24},"generated":{"line":1,"column":857}},{"source":"../routes/sub.js","name":"buildResponse","original":{"line":17,"column":30},"generated":{"line":1,"column":859}},{"source":"../routes/sub.js","original":{"line":17,"column":44},"generated":{"line":1,"column":874}},{"source":"../routes/sub.js","original":{"line":17,"column":51},"generated":{"line":1,"column":876}},{"source":"../routes/sub.js","original":{"line":4,"column":17},"generated":{"line":1,"column":900}},{"source":"../routes/sub.js","original":{"line":4,"column":17},"generated":{"line":1,"column":905}},{"source":"../routes/sub.js","original":{"line":19,"column":8},"generated":{"line":1,"column":908}},{"source":"../routes/sub.js","name":"channel","original":{"line":19,"column":9},"generated":{"line":1,"column":911}},{"source":"../routes/sub.js","original":{"line":19,"column":8},"generated":{"line":1,"column":914}},{"source":"../routes/sub.js","name":"channel","original":{"line":19,"column":20},"generated":{"line":1,"column":920}},{"source":"../routes/sub.js","original":{"line":4,"column":17},"generated":{"line":1,"column":922}},{"source":"../routes/sub.js","original":{"line":4,"column":17},"generated":{"line":1,"column":923}},{"source":"../routes/sub.js","original":{"line":4,"column":17},"generated":{"line":1,"column":925}},{"source":"../routes/sub.js","original":{"line":4,"column":17},"generated":{"line":1,"column":930}},{"source":"../routes/sub.js","original":{"line":4,"column":17},"generated":{"line":1,"column":933}},{"source":"../routes/sub.js","name":"res","original":{"line":20,"column":15},"generated":{"line":1,"column":939}},{"source":"../routes/sub.js","name":"res","original":{"line":20,"column":15},"generated":{"line":1,"column":946}},{"source":"../routes/sub.js","name":"res","original":{"line":20,"column":15},"generated":{"line":1,"column":948}},{"source":"../routes/sub.js","name":"res","original":{"line":20,"column":15},"generated":{"line":1,"column":955}},{"source":"../routes/sub.js","name":"res","original":{"line":20,"column":15},"generated":{"line":1,"column":964}},{"source":"../routes/sub.js","name":"send","original":{"line":20,"column":19},"generated":{"line":1,"column":966}},{"source":"../routes/sub.js","name":"Utils","original":{"line":20,"column":24},"generated":{"line":1,"column":971}},{"source":"../routes/sub.js","name":"buildResponse","original":{"line":20,"column":30},"generated":{"line":1,"column":973}},{"source":"../routes/sub.js","original":{"line":20,"column":44},"generated":{"line":1,"column":988}},{"source":"../routes/sub.js","original":{"line":20,"column":51},"generated":{"line":1,"column":990}},{"source":"../routes/sub.js","original":{"line":4,"column":17},"generated":{"line":1,"column":1020}},{"source":"../routes/sub.js","original":{"line":4,"column":17},"generated":{"line":1,"column":1025}},{"source":"../routes/sub.js","name":"console","original":{"line":21,"column":4},"generated":{"line":1,"column":1028}},{"source":"../routes/sub.js","name":"log","original":{"line":21,"column":12},"generated":{"line":1,"column":1036}},{"source":"../routes/sub.js","original":{"line":21,"column":16},"generated":{"line":1,"column":1040}},{"source":"../routes/sub.js","name":"MidoDb","original":{"line":24,"column":4},"generated":{"line":1,"column":1053}},{"source":"../routes/sub.js","name":"init","original":{"line":24,"column":11},"generated":{"line":1,"column":1055}},{"source":"../routes/sub.js","original":{"line":24,"column":16},"generated":{"line":1,"column":1060}},{"source":"../routes/sub.js","name":"then","original":{"line":25,"column":9},"generated":{"line":1,"column":1071}},{"source":"../routes/sub.js","original":{"line":25,"column":14},"generated":{"line":1,"column":1076}},{"source":"../routes/sub.js","name":"db","original":{"line":25,"column":14},"generated":{"line":1,"column":1085}},{"source":"../routes/sub.js","name":"query","original":{"line":26,"column":18},"generated":{"line":1,"column":1088}},{"source":"../routes/sub.js","name":"query","original":{"line":26,"column":18},"generated":{"line":1,"column":1092}},{"source":"../routes/sub.js","original":{"line":26,"column":26},"generated":{"line":1,"column":1094}},{"source":"../routes/sub.js","name":"user_id","original":{"line":26,"column":27},"generated":{"line":1,"column":1095}},{"source":"../routes/sub.js","name":"userId","original":{"line":26,"column":36},"generated":{"line":1,"column":1103}},{"source":"../routes/sub.js","name":"channel_id","original":{"line":26,"column":44},"generated":{"line":1,"column":1105}},{"source":"../routes/sub.js","name":"channelId","original":{"line":26,"column":56},"generated":{"line":1,"column":1116}},{"source":"../routes/sub.js","name":"MidoDb","original":{"line":27,"column":12},"generated":{"line":1,"column":1119}},{"source":"../routes/sub.js","name":"selectRecord","original":{"line":27,"column":19},"generated":{"line":1,"column":1121}},{"source":"../routes/sub.js","name":"baseTable","original":{"line":27,"column":32},"generated":{"line":1,"column":1134}},{"source":"../routes/sub.js","name":"query","original":{"line":27,"column":43},"generated":{"line":1,"column":1136}},{"source":"../routes/sub.js","name":"then","original":{"line":27,"column":50},"generated":{"line":1,"column":1139}},{"source":"../routes/sub.js","original":{"line":27,"column":55},"generated":{"line":1,"column":1144}},{"source":"../routes/sub.js","name":"record","original":{"line":27,"column":55},"generated":{"line":1,"column":1153}},{"source":"../routes/sub.js","name":"record","original":{"line":29,"column":20},"generated":{"line":1,"column":1156}},{"source":"../routes/sub.js","name":"console","original":{"line":28,"column":16},"generated":{"line":1,"column":1159}},{"source":"../routes/sub.js","name":"log","original":{"line":28,"column":24},"generated":{"line":1,"column":1167}},{"source":"../routes/sub.js","name":"record","original":{"line":28,"column":28},"generated":{"line":1,"column":1171}},{"source":"../routes/sub.js","name":"record","original":{"line":29,"column":20},"generated":{"line":1,"column":1174}},{"source":"../routes/sub.js","name":"length","original":{"line":29,"column":27},"generated":{"line":1,"column":1176}},{"source":"../routes/sub.js","name":"record","original":{"line":29,"column":37},"generated":{"line":1,"column":1184}},{"source":"../routes/sub.js","name":"length","original":{"line":29,"column":44},"generated":{"line":1,"column":1186}},{"source":"../routes/sub.js","original":{"line":29,"column":54},"generated":{"line":1,"column":1194}},{"source":"../routes/sub.js","original":{"line":29,"column":57},"generated":{"line":1,"column":1196}},{"source":"../routes/sub.js","name":"res","original":{"line":32,"column":27},"generated":{"line":1,"column":1197}},{"source":"../routes/sub.js","name":"MidoDb","original":{"line":31,"column":20},"generated":{"line":1,"column":1204}},{"source":"../routes/sub.js","name":"closeDb","original":{"line":31,"column":27},"generated":{"line":1,"column":1206}},{"source":"../routes/sub.js","name":"res","original":{"line":32,"column":27},"generated":{"line":1,"column":1216}},{"source":"../routes/sub.js","name":"send","original":{"line":32,"column":31},"generated":{"line":1,"column":1218}},{"source":"../routes/sub.js","name":"Utils","original":{"line":32,"column":36},"generated":{"line":1,"column":1223}},{"source":"../routes/sub.js","name":"buildResponse","original":{"line":32,"column":42},"generated":{"line":1,"column":1225}},{"source":"../routes/sub.js","original":{"line":32,"column":56},"generated":{"line":1,"column":1240}},{"source":"../routes/sub.js","original":{"line":30,"column":32},"generated":{"line":1,"column":1242}},{"source":"../routes/sub.js","name":"MidoDb","original":{"line":35,"column":16},"generated":{"line":1,"column":1273}},{"source":"../routes/sub.js","name":"init","original":{"line":35,"column":23},"generated":{"line":1,"column":1275}},{"source":"../routes/sub.js","original":{"line":35,"column":28},"generated":{"line":1,"column":1280}},{"source":"../routes/sub.js","name":"then","original":{"line":36,"column":21},"generated":{"line":1,"column":1291}},{"source":"../routes/sub.js","original":{"line":36,"column":26},"generated":{"line":1,"column":1296}},{"source":"../routes/sub.js","name":"db","original":{"line":36,"column":26},"generated":{"line":1,"column":1305}},{"source":"../routes/sub.js","name":"insertRecord","original":{"line":37,"column":30},"generated":{"line":1,"column":1308}},{"source":"../routes/sub.js","name":"insertRecord","original":{"line":37,"column":30},"generated":{"line":1,"column":1312}},{"source":"../routes/sub.js","original":{"line":37,"column":45},"generated":{"line":1,"column":1314}},{"source":"../routes/sub.js","name":"user_id","original":{"line":37,"column":46},"generated":{"line":1,"column":1315}},{"source":"../routes/sub.js","name":"userId","original":{"line":37,"column":55},"generated":{"line":1,"column":1323}},{"source":"../routes/sub.js","name":"channel_id","original":{"line":37,"column":63},"generated":{"line":1,"column":1325}},{"source":"../routes/sub.js","name":"channelId","original":{"line":37,"column":75},"generated":{"line":1,"column":1336}},{"source":"../routes/sub.js","name":"channel","original":{"line":37,"column":86},"generated":{"line":1,"column":1338}},{"source":"../routes/sub.js","name":"channel","original":{"line":37,"column":95},"generated":{"line":1,"column":1346}},{"source":"../routes/sub.js","name":"status","original":{"line":37,"column":104},"generated":{"line":1,"column":1348}},{"source":"../routes/sub.js","original":{"line":37,"column":112},"generated":{"line":1,"column":1355}},{"source":"../routes/sub.js","name":"MidoDb","original":{"line":38,"column":24},"generated":{"line":1,"column":1358}},{"source":"../routes/sub.js","name":"insertRecord","original":{"line":38,"column":31},"generated":{"line":1,"column":1360}},{"source":"../routes/sub.js","name":"insertRecord","original":{"line":38,"column":44},"generated":{"line":1,"column":1373}},{"source":"../routes/sub.js","name":"baseTable","original":{"line":38,"column":58},"generated":{"line":1,"column":1375}},{"source":"../routes/sub.js","name":"then","original":{"line":38,"column":69},"generated":{"line":1,"column":1378}},{"source":"../routes/sub.js","original":{"line":38,"column":74},"generated":{"line":1,"column":1383}},{"source":"../routes/sub.js","name":"result","original":{"line":38,"column":74},"generated":{"line":1,"column":1392}},{"source":"../routes/sub.js","name":"result","original":{"line":39,"column":32},"generated":{"line":1,"column":1395}},{"source":"../routes/sub.js","original":{"line":39,"column":46},"generated":{"line":1,"column":1398}},{"source":"../routes/sub.js","name":"result","original":{"line":39,"column":32},"generated":{"line":1,"column":1402}},{"source":"../routes/sub.js","name":"ok","original":{"line":39,"column":39},"generated":{"line":1,"column":1404}},{"source":"../routes/sub.js","original":{"line":39,"column":49},"generated":{"line":1,"column":1407}},{"source":"../routes/sub.js","name":"res","original":{"line":42,"column":39},"generated":{"line":1,"column":1408}},{"source":"../routes/sub.js","name":"MidoDb","original":{"line":41,"column":32},"generated":{"line":1,"column":1415}},{"source":"../routes/sub.js","name":"closeDb","original":{"line":41,"column":39},"generated":{"line":1,"column":1417}},{"source":"../routes/sub.js","name":"res","original":{"line":42,"column":39},"generated":{"line":1,"column":1427}},{"source":"../routes/sub.js","name":"send","original":{"line":42,"column":43},"generated":{"line":1,"column":1429}},{"source":"../routes/sub.js","name":"Utils","original":{"line":42,"column":48},"generated":{"line":1,"column":1434}},{"source":"../routes/sub.js","name":"buildResponse","original":{"line":42,"column":54},"generated":{"line":1,"column":1436}},{"source":"../routes/sub.js","original":{"line":42,"column":68},"generated":{"line":1,"column":1451}},{"source":"../routes/sub.js","original":{"line":40,"column":44},"generated":{"line":1,"column":1453}},{"source":"../routes/sub.js","name":"res","original":{"line":47,"column":35},"generated":{"line":1,"column":1495}},{"source":"../routes/sub.js","name":"MidoDb","original":{"line":46,"column":28},"generated":{"line":1,"column":1502}},{"source":"../routes/sub.js","name":"closeDb","original":{"line":46,"column":35},"generated":{"line":1,"column":1504}},{"source":"../routes/sub.js","name":"res","original":{"line":47,"column":35},"generated":{"line":1,"column":1514}},{"source":"../routes/sub.js","name":"send","original":{"line":47,"column":39},"generated":{"line":1,"column":1516}},{"source":"../routes/sub.js","name":"Utils","original":{"line":47,"column":44},"generated":{"line":1,"column":1521}},{"source":"../routes/sub.js","name":"buildResponse","original":{"line":47,"column":50},"generated":{"line":1,"column":1523}},{"source":"../routes/sub.js","original":{"line":47,"column":64},"generated":{"line":1,"column":1538}},{"source":"../routes/sub.js","original":{"line":45,"column":40},"generated":{"line":1,"column":1540}},{"source":"../routes/sub.js","original":{"line":47,"column":75},"generated":{"line":1,"column":1565}},{"source":"../routes/sub.js","original":{"line":47,"column":81},"generated":{"line":1,"column":1570}},{"source":"../routes/sub.js","name":"result","original":{"line":47,"column":87},"generated":{"line":1,"column":1575}},{"source":"../routes/sub.js","name":"catch","original":{"line":49,"column":27},"generated":{"line":1,"column":1581}},{"source":"../routes/sub.js","original":{"line":49,"column":33},"generated":{"line":1,"column":1587}},{"source":"../routes/sub.js","name":"err","original":{"line":49,"column":33},"generated":{"line":1,"column":1596}},{"source":"../routes/sub.js","name":"console","original":{"line":49,"column":40},"generated":{"line":1,"column":1599}},{"source":"../routes/sub.js","name":"console","original":{"line":49,"column":40},"generated":{"line":1,"column":1606}},{"source":"../routes/sub.js","name":"log","original":{"line":49,"column":48},"generated":{"line":1,"column":1614}},{"source":"../routes/sub.js","name":"err","original":{"line":49,"column":52},"generated":{"line":1,"column":1618}},{"source":"../routes/sub.js","name":"message","original":{"line":49,"column":56},"generated":{"line":1,"column":1620}},{"source":"../routes/sub.js","name":"catch","original":{"line":51,"column":23},"generated":{"line":1,"column":1633}},{"source":"../routes/sub.js","original":{"line":51,"column":29},"generated":{"line":1,"column":1639}},{"source":"../routes/sub.js","name":"err","original":{"line":51,"column":29},"generated":{"line":1,"column":1648}},{"source":"../routes/sub.js","name":"console","original":{"line":51,"column":36},"generated":{"line":1,"column":1651}},{"source":"../routes/sub.js","name":"console","original":{"line":51,"column":36},"generated":{"line":1,"column":1658}},{"source":"../routes/sub.js","name":"log","original":{"line":51,"column":44},"generated":{"line":1,"column":1666}},{"source":"../routes/sub.js","name":"err","original":{"line":51,"column":48},"generated":{"line":1,"column":1670}},{"source":"../routes/sub.js","name":"message","original":{"line":51,"column":52},"generated":{"line":1,"column":1672}},{"source":"../routes/sub.js","name":"catch","original":{"line":53,"column":17},"generated":{"line":1,"column":1685}},{"source":"../routes/sub.js","original":{"line":53,"column":23},"generated":{"line":1,"column":1691}},{"source":"../routes/sub.js","name":"err","original":{"line":53,"column":23},"generated":{"line":1,"column":1700}},{"source":"../routes/sub.js","name":"console","original":{"line":53,"column":30},"generated":{"line":1,"column":1703}},{"source":"../routes/sub.js","name":"console","original":{"line":53,"column":30},"generated":{"line":1,"column":1710}},{"source":"../routes/sub.js","name":"log","original":{"line":53,"column":38},"generated":{"line":1,"column":1718}},{"source":"../routes/sub.js","name":"err","original":{"line":53,"column":42},"generated":{"line":1,"column":1722}},{"source":"../routes/sub.js","name":"message","original":{"line":53,"column":46},"generated":{"line":1,"column":1724}},{"source":"../routes/sub.js","name":"catch","original":{"line":55,"column":11},"generated":{"line":1,"column":1737}},{"source":"../routes/sub.js","original":{"line":55,"column":17},"generated":{"line":1,"column":1743}},{"source":"../routes/sub.js","name":"err","original":{"line":55,"column":17},"generated":{"line":1,"column":1752}},{"source":"../routes/sub.js","name":"console","original":{"line":55,"column":24},"generated":{"line":1,"column":1755}},{"source":"../routes/sub.js","name":"console","original":{"line":55,"column":24},"generated":{"line":1,"column":1762}},{"source":"../routes/sub.js","name":"log","original":{"line":55,"column":32},"generated":{"line":1,"column":1770}},{"source":"../routes/sub.js","name":"err","original":{"line":55,"column":36},"generated":{"line":1,"column":1774}},{"source":"../routes/sub.js","original":{"line":4,"column":17},"generated":{"line":1,"column":1779}},{"source":"../routes/sub.js","original":{"line":4,"column":17},"generated":{"line":1,"column":1784}},{"source":"../routes/sub.js","original":{"line":4,"column":17},"generated":{"line":1,"column":1787}},{"source":"../routes/sub.js","original":{"line":4,"column":17},"generated":{"line":1,"column":1791}},{"source":"../routes/sub.js","original":{"line":4,"column":17},"generated":{"line":1,"column":1797}},{"source":"../routes/sub.js","original":{"line":4,"column":17},"generated":{"line":1,"column":1804}},{"source":"../routes/sub.js","original":{"line":4,"column":17},"generated":{"line":1,"column":1806}},{"source":"../routes/sub.js","original":{"line":4,"column":17},"generated":{"line":1,"column":1815}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":1821}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":1828}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":1837}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":1839}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":1841}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":1844}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":1851}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":1853}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":1859}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":1864}},{"source":"../routes/sub.js","original":{"line":4,"column":0},"generated":{"line":1,"column":1876}}],"sources":{"../routes/sub.js":"const MidoDb = require(\"./../lib/MidoDb\");\nconst Utils = require(\"./../lib/Utils\");\n\nmodule.exports = async (req, res, next, baseTable = \"channel_subscription\") => {\n    /* get the params */\n    const data = req.query;\n    const session = req.session;\n\n    if (!data || !data['channel-id'])\n        return res.send(Utils.buildResponse(false, \"invalid params\"));\n\n    const channelId = data['channel-id'];\n    const channel = data.channel;\n    const userId = session.user_id;\n\n    if (!userId || userId === null || userId === undefined)\n        return res.send(Utils.buildResponse(false, \"Please login first\"));\n\n    if (!channel || channel === null || channel === undefined)\n        return res.send(Utils.buildResponse(false, \"Invalid channel selected\"));\n    console.log(\"test here\");\n\n    // check if this user is already subscribe to channel\n    MidoDb.init(\"mongodb\")\n        .then(db => {\n            const query = {user_id: userId, channel_id: channelId};\n            MidoDb.selectRecord(baseTable, query).then(record => {\n                console.log(record);\n                if (record.length && record.length >= 0) {\n                    const msg = \"You are already subscribed\";\n                    MidoDb.closeDb();\n                    return res.send(Utils.buildResponse(false, msg));\n                }\n                // add subscription\n                MidoDb.init(\"mongodb\")\n                    .then(db => {\n                        const insertRecord = {user_id: userId, channel_id: channelId, channel: channel, status: 1};\n                        MidoDb.insertRecord(insertRecord, baseTable).then(result => {\n                            if (result.ok !== 1) {\n                                const msg = \"Could not subscribe. Please try again\";\n                                MidoDb.closeDb();\n                                return res.send(Utils.buildResponse(false, msg));\n                            }\n                            // registration completed\n                            const msg = \"You are now subscribed\";\n                            MidoDb.closeDb();\n                            return res.send(Utils.buildResponse(true, msg, null, null, result));\n\n                        }).catch(err => console.log(err.message));\n\n                    }).catch(err => console.log(err.message));\n            })\n                .catch(err => console.log(err.message));\n\n        }).catch(err => console.log(err));\n\n}"},"lineCount":null}},"error":null,"hash":"642133dcbc75bed3c7c35c82e28caeed","cacheData":{"env":{}}}